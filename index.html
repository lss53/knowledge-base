<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>JSMD WebSite [zyxβ2507]</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      display: flex;
      margin: 0;
      height: 100vh;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f8f9fa;
    }
    
    #sidebar-container {
      width: 300px;
      background: #f1f3f5;
      overflow-y: auto;
      height: 100vh;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      z-index: 100;
    }
    
    #sidebar-container.hidden {
      transform: translateX(-100%);
      box-shadow: none;
    }
    
    #sidebar {
      padding: 1.5em;
    }
    
    #sidebar h1 {
      font-size: 1.5em;
      margin-bottom: 1em;
      color: #2c3e50;
      border-bottom: 2px solid #6c5ce7;
      padding-bottom: 0.5em;
    }
    
    #sidebar h2 {
      font-size: 1.2em;
      margin: 1.5em 0 0.8em 0;
      color: #34495e;
    }
    
    #sidebar ul {
      list-style: none;
    }
    
    #sidebar li {
      line-height: 1.6;
      margin: 0.5em 0;
      padding: 0.3em 0.5em;
      border-radius: 4px;
      transition: background 0.2s;
    }
    
    #sidebar li:hover {
      background: #e9ecef;
    }
    
    #menu-button {
      position: fixed;
      top: 10px;
      left: 10px;
      width: 40px;
      height: 40px;
      border: none;
      z-index: 1000;
      background: #6c5ce7;
      color: white;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      transition: all 0.3s ease;
    }
    
    #menu-button:hover {
      background: #5b4cdb;
      transform: scale(1.05);
    }
    
    #content {
      padding: 2em;
      flex: 1;
      overflow-y: auto;
      height: 100vh;
      background: white;
      transition: margin-left 0.3s ease;
    }
    
    @media (max-width: 768px) {
      #sidebar-container {
        position: fixed;
        width: 80%;
        max-width: 300px;
      }
      
      #sidebar-container:not(.hidden) {
        box-shadow: 3px 0 15px rgba(0, 0, 0, 0.2);
      }
      
      #content {
        margin-left: 0;
        width: 100%;
      }
    }
    
    a {
      text-decoration: none;
      color: #6c5ce7;
      transition: color 0.2s;
    }
    
    a:hover {
      color: #f0932b;
      text-decoration: underline;
    }
    
    .markdown-body {
      max-width: 900px;
      margin: 0 auto;
    }
    
    .katex {
      font-size: 1.1em;
    }
    
    /* 加载动画 */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .markdown-body {
      animation: fadeIn 0.5s ease;
    }
    
    /* 滚动条样式 */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c2c2c2;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
  </style>
</head>
<body>
  <div id="sidebar-container">
    <div id="sidebar" class="markdown-body"></div>
  </div>
  <button id="menu-button">☰</button>
  <div id="content" class="markdown-body">
    <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
      <div style="text-align: center;">
        <h1>JSMD WebSite</h1>
        <p>加载中...</p>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
  <script>
    // 配置markdown-it以支持数学公式
    const md = window.markdownit({
      html: true,
      linkify: true,
      typographer: true
    });
    
    md.use(window.texmath, {
      engine: window.katex,
      delimiters: 'dollars',
      katexOptions: { 
        macros: { 
          "\\RR": "\\mathbb{R}",
          "\\Z": "\\mathbb{Z}",
          "\\Q": "\\mathbb{Q}",
          "\\C": "\\mathbb{C}"
        } 
      }
    });
    
    // 初始化侧边栏状态
    let sidebarHidden = window.innerWidth <= 768;
    const savedState = localStorage.getItem('sidebarHidden');
    if (savedState !== null) {
      sidebarHidden = JSON.parse(savedState);
    }
    
    // 转换链接格式
    const convertLinks = text => text
      .replace(/\[\[([^\]]+)\]\]/g, '[$1](?$1)')
      .replace(/\[([^\]]+)\]\(([^)]+)\.md\)/g, '[$1](?$2)');
    
    // 更新侧边栏状态
    const updateSidebarState = () => {
      const sidebarContainer = document.getElementById('sidebar-container');
      const menuButton = document.getElementById('menu-button');
      
      sidebarContainer.classList.toggle('hidden', sidebarHidden);
      menuButton.textContent = sidebarHidden ? '☰' : '✕';
      menuButton.style.left = sidebarHidden ? '10px' : 'calc(300px + 10px)';
      
      if (window.innerWidth > 768) {
        localStorage.setItem('sidebarHidden', JSON.stringify(sidebarHidden));
      }
    };

    // 加载Markdown内容
    const loadMarkdown = file => {
      fetch(file)
        .then(res => {
          if (!res.ok) throw new Error('文件未找到');
          return res.text();
        })
        .then(text => {
          document.getElementById('content').innerHTML = md.render(convertLinks(text));
          document.title = decodeURIComponent(file.replace('.md', '')) + ' - JSMD WebSite';
          document.getElementById('content').scrollTop = 0;
          
          // 为内容中的链接添加事件监听
          document.querySelectorAll('#content a').forEach(link => {
            const href = link.getAttribute('href');
            if (href && href.startsWith('?')) {
              link.addEventListener('click', e => {
                e.preventDefault();
                handleLinkClick(href);
              });
            }
          });
        })
        .catch(err => {
          document.getElementById('content').innerHTML = `
            <h1>404 - 未找到文件</h1>
            <p>请求的文件 <code>${file}</code> 不存在。</p>
            <p><a href="?README">返回首页</a></p>
          `;
          document.title = '404 - 未找到文件';
        });
    };

    // 处理链接点击
    const handleLinkClick = href => {
      const page = href.startsWith('?') ? href.substring(1) : href.replace('.md', '');
      history.pushState(null, '', `?${page}`);
      loadMarkdown(`${page}.md`);
      
      if (window.innerWidth <= 768) {
        sidebarHidden = true;
        updateSidebarState();
      }
    };

    // 获取当前文件参数
    const getFile = () => {
      const params = new URLSearchParams(window.location.search);
      const firstParam = Array.from(params.keys())[0];
      return firstParam ? `${firstParam}.md` : 'README.md';
    };

    // DOM加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
      const menuButton = document.getElementById('menu-button');
      
      menuButton.addEventListener('click', () => {
        sidebarHidden = !sidebarHidden;
        updateSidebarState();
      });
      
      // 点击内容区域隐藏侧边栏（移动设备）
      if (window.innerWidth <= 768) {
        document.getElementById('content').addEventListener('click', () => {
          if (!sidebarHidden) {
            sidebarHidden = true;
            updateSidebarState();
          }
        });
      }
      
      updateSidebarState();
      
      // 加载侧边栏
      fetch('_sidebar.md')
        .then(res => res.text())
        .then(text => {
          const sidebarElement = document.getElementById('sidebar');
          sidebarElement.innerHTML = md.render(convertLinks(text));
          
          // 为侧边栏链接添加事件监听
          sidebarElement.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', e => {
              e.preventDefault();
              handleLinkClick(link.getAttribute('href'));
            });
          });
        })
        .catch(err => {
          console.error('无法加载侧边栏: ', err);
          document.getElementById('sidebar').innerHTML = `
            <h1>JSMD WebSite</h1>
            <p>无法加载侧边栏导航</p>
            <ul>
              <li><a href="?README">首页</a></li>
            </ul>
          `;
        });
      
      // 加载初始内容
      loadMarkdown(getFile());
    });

    // 处理浏览器前进/后退
    window.addEventListener('popstate', () => {
      loadMarkdown(getFile());
    });
  </script>
</body>
</html>