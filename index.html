<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JSMD WebSite [zyxβ2507]</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css">
  <style>
    :root {
      --primary-color: #007bff;
      --sidebar-width: 300px;
      --transition-speed: 0.3s;
      --search-highlight-color: #fffd54;
    }
    
    * { box-sizing: border-box; }
    
    body { 
      display: flex; 
      margin: 0; 
      height: 100vh; 
      overflow: hidden; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      line-height: 1.6;
    }
    
    #sidebar-container { 
      width: var(--sidebar-width); 
      background: #f8f9fa; 
      overflow-y: auto; 
      height: 100vh; 
      transition: transform var(--transition-speed) ease, width var(--transition-speed) ease;
      border-right: 1px solid #e9ecef;
      z-index: 100;
      position: relative;
    }
    
    #sidebar-container.hidden { 
      transform: translateX(calc(var(--sidebar-width) * -1));
      border-right: none;
      width: 0;
    }
    
    #sidebar { 
      padding: 1.5rem; 
      width: var(--sidebar-width);
      position: relative;
    }
    
    #sidebar ul {
      padding-left: 1.2rem;
    }
    
    #sidebar li { 
      margin: 0.5rem 0; 
    }
    
    #sidebar h1, #sidebar h2 { 
      margin: 1.5rem 0 1rem 0; 
      border-bottom: 1px solid #e9ecef;
      padding-bottom: 0.5rem;
    }
    
    #menu-button { 
      position: fixed; 
      top: 50%; 
      transform: translateY(-50%); 
      left: 0;
      width: 24px; 
      height: 60px; 
      border: none; 
      z-index: 1000; 
      background: var(--primary-color);
      color: white;
      cursor: pointer;
      border-radius: 0 4px 4px 0;
      transition: all var(--transition-speed);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    #menu-button:hover { 
      background: #0056b3; 
      width: 28px;
    }
    
    #content { 
      padding: 2rem; 
      flex: 1; 
      overflow-y: auto; 
      height: 100vh; 
      transition: all var(--transition-speed);
      margin-left: 0;
      width: 100%;
    }
    
    .sidebar-visible #content {
      margin-left: var(--sidebar-width);
      width: calc(100% - var(--sidebar-width));
    }
    
    @media (max-width: 768px) { 
      #sidebar-container { 
        position: fixed; 
        left: 0; 
        top: 0;
        height: 100%;
        width: 85vw;
        max-width: 300px;
        box-shadow: 2px 0 12px rgba(0,0,0,0.15);
      } 
      
      #sidebar-container.hidden { 
        transform: translateX(calc(-85vw - 5px));
        width: 85vw;
      }
      
      #sidebar {
        width: 85vw;
        max-width: 300px;
      }
      
      .sidebar-visible #content {
        margin-left: 0;
        width: 100%;
      }
      
      #sidebar-container:not(.hidden) ~ #content { 
        opacity: 0.3; 
        pointer-events: none;
      } 
      
      #menu-button {
        z-index: 1001;
        left: 0;
      }
      
      #sidebar-container:not(.hidden) ~ #menu-button {
        left: 85vw;
      }
    }
    
    a { 
      text-decoration: none; 
      color: var(--primary-color); 
      transition: color 0.2s; 
    }
    
    a:hover { 
      color: #0056b3; 
      text-decoration: underline;
    }
    
    /* Loading indicator */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 50vh;
      color: #6c757d;
    }
    
    .loading-spinner { 
      display: inline-block;
      width: 32px;
      height: 32px;
      border: 3px solid rgba(0, 123, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 1rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Content transitions */
    .content-transition {
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0.7; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Error states */
    .error-container {
      padding: 2rem;
      text-align: center;
      color: #dc3545;
    }
    
    .error-container h2 {
      margin-top: 0;
    }
    
    /* MathJax specific styles */
    .MathJax { outline: 0; }
    .MathJax_Display { overflow-x: auto; overflow-y: hidden; }
    
    /* Search box */
    #search-container {
      position: relative;
      margin: 1rem 0;
    }
    
    #search-box {
      padding: 0.75rem;
      width: 100%;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 1rem;
      transition: all 0.2s;
    }
    
    #search-box:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
    }
    
    #search-box.loading {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23007bff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-loader'%3E%3Cline x1='12' y1='2' x2='12' y2='6'%3E%3C/line%3E%3Cline x1='12' y1='18' x2='12' y2='22'%3E%3C/line%3E%3Cline x1='4.93' y1='4.93' x2='7.76' y2='7.76'%3E%3C/line%3E%3Cline x1='16.24' y1='16.24' x2='19.07' y2='19.07'%3E%3C/line%3E%3Cline x1='2' y1='12' x2='6' y2='12'%3E%3C/line%3E%3Cline x1='18' y1='12' x2='22' y2='12'%3E%3C/line%3E%3Cline x1='4.93' y1='19.07' x2='7.76' y2='16.24'%3E%3C/line%3E%3Cline x1='16.24' y1='7.76' x2='19.07' y2='4.93'%3E%3C/line%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 20px;
    }
    
    #search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 4px 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-height: 300px;
      overflow-y: auto;
      z-index: 200;
      display: none;
    }
    
    #search-results.visible {
      display: block;
    }
    
    .search-result-item {
      padding: 0.75rem;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .search-result-item:hover, .search-result-item.selected {
      background-color: #f8f9fa;
    }
    
    .search-result-item .title {
      font-weight: 500;
    }
    
    .search-result-item .path {
      font-size: 0.8rem;
      color: #6c757d;
      margin-left: 0.5rem;
    }
    
    .search-result-item .match-type {
      font-size: 0.7rem;
      background: #e9ecef;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      color: #495057;
    }
    
    .no-results {
      padding: 0.75rem;
      color: #6c757d;
      text-align: center;
    }
    
    .search-highlight {
      background-color: var(--search-highlight-color);
      padding: 0 2px;
      border-radius: 2px;
    }
    
    /* Search history */
    #search-history {
      margin-top: 0.5rem;
      font-size: 0.85rem;
    }
    
    .history-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #495057;
    }
    
    .history-items {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .history-item {
      background: #e9ecef;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .history-item:hover {
      background: #dee2e6;
    }
    
    .clear-history {
      color: var(--primary-color);
      cursor: pointer;
      margin-left: auto;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>
  <div id="sidebar-container">
    <div id="sidebar" class="markdown-body"></div>
  </div>
  <button id="menu-button" aria-label="Toggle sidebar">☰</button>
  <div id="content" class="markdown-body">
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading content...</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
  <script>
    // 使用模块模式封装代码
    const JSMD = (() => {
      // 配置常量
      const CONFIG = {
        cacheExpiry: 5 * 60 * 1000, // 5分钟缓存
        mathJaxURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
        defaultFile: 'README.md',
        sidebarFile: '_sidebar.md',
        searchThreshold: 0.4, // 搜索匹配阈值
        searchKeys: [
          { name: 'title', weight: 0.7 },
          { name: 'content', weight: 0.3 }
        ],
        maxSearchResults: 10,
        searchHistorySize: 5
      };
      
      // 状态管理
      const state = {
        sidebarHidden: window.innerWidth <= 768,
        contentCache: new Map(),
        currentFile: '',
        mathJaxLoaded: false,
        searchIndex: null,
        searchData: [],
        searchHistory: JSON.parse(localStorage.getItem('searchHistory')) || []
      };
      
      // DOM 元素引用
      const elements = {
        sidebarContainer: document.getElementById('sidebar-container'),
        sidebar: document.getElementById('sidebar'),
        menuButton: document.getElementById('menu-button'),
        content: document.getElementById('content'),
        searchBox: null,
        searchResults: null,
        searchContainer: null
      };
      
      // Markdown 处理器
      const md = window.markdownit();
      
      // 初始化
      function init() {
        loadSavedState();
        setupEventListeners();
        loadSidebar();
        loadContent(getCurrentFile());
        updateBodyClass();
        
        // 预加载MathJax（低优先级）
        if ('requestIdleCallback' in window) {
          requestIdleCallback(() => loadMathJax());
        } else {
          setTimeout(() => loadMathJax(), 3000);
        }
      }
      
      // 更新body类以反映侧边栏状态
      function updateBodyClass() {
        if (state.sidebarHidden) {
          document.body.classList.remove('sidebar-visible');
        } else {
          document.body.classList.add('sidebar-visible');
        }
      }
      
      // 加载保存的状态
      function loadSavedState() {
        const savedState = localStorage.getItem('sidebarHidden');
        if (savedState !== null) {
          state.sidebarHidden = JSON.parse(savedState);
        }
        updateSidebarState();
      }
      
      // 设置事件监听器
      function setupEventListeners() {
        elements.menuButton.addEventListener('click', toggleSidebar);
        
        // 键盘快捷键
        document.addEventListener('keydown', handleKeydown);
        
        // 处理浏览器历史
        window.addEventListener('popstate', handlePopState);
        
        // 响应窗口大小变化
        window.addEventListener('resize', handleResize);
      }
      
      // 切换侧边栏
      function toggleSidebar() {
        state.sidebarHidden = !state.sidebarHidden;
        updateSidebarState();
        updateBodyClass();
        saveSidebarState();
      }
      
      // 更新侧边栏状态
      function updateSidebarState() {
        elements.sidebarContainer.classList.toggle('hidden', state.sidebarHidden);
        elements.menuButton.textContent = state.sidebarHidden ? '☰' : '✕';
        elements.menuButton.setAttribute('aria-label', 
          state.sidebarHidden ? 'Open sidebar' : 'Close sidebar');
      }
      
      // 保存侧边栏状态
      function saveSidebarState() {
        if (window.innerWidth > 768) {
          localStorage.setItem('sidebarHidden', JSON.stringify(state.sidebarHidden));
        }
      }
      
      // 处理键盘事件
      function handleKeydown(e) {
        // Ctrl/Cmd + B 切换侧边栏
        if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
          e.preventDefault();
          toggleSidebar();
        }
        
        // ESC 键关闭侧边栏（在移动设备上）
        if (e.key === 'Escape' && window.innerWidth <= 768 && !state.sidebarHidden) {
          state.sidebarHidden = true;
          updateSidebarState();
          updateBodyClass();
        }
      }
      
      // 处理浏览器历史变化
      function handlePopState() {
        loadContent(getCurrentFile());
      }
      
      // 处理窗口大小变化
      function handleResize() {
        // 在移动设备上，当窗口变大时自动显示侧边栏
        if (window.innerWidth > 768 && state.sidebarHidden) {
          state.sidebarHidden = false;
          updateSidebarState();
          updateBodyClass();
        }
      }
      
      // 转换链接
      function convertLinks(text) {
        return text
          .replace(/\[\[([^\]]+)\]\]/g, '[$1](?$1)')
          .replace(/\[([^\]]+)\]\(([^)]+)\.md\)/g, '[$1](?$2)');
      }
      
      // 异步加载MathJax
      function loadMathJax() {
        return new Promise((resolve) => {
          if (window.MathJax) {
            state.mathJaxLoaded = true;
            resolve();
            return;
          }
          
          const script = document.createElement('script');
          script.src = CONFIG.mathJaxURL;
          script.async = true;
          
          // 配置MathJax
          window.MathJax = {
            tex: {
              inlineMath: [['$', '$']],
              displayMath: [['$$', '$$']],
              processEscapes: true
            },
            chtml: {
              fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
            },
            startup: {
              pageReady: () => {
                state.mathJaxLoaded = true;
                console.log('MathJax loaded');
                resolve();
                return Promise.resolve();
              }
            }
          };
          
          script.onerror = () => {
            console.error('Failed to load MathJax');
            resolve(); // 即使加载失败也继续执行
          };
          
          document.head.appendChild(script);
        });
      }
      
      // 获取当前文件
      function getCurrentFile() {
        const params = new URLSearchParams(window.location.search);
        const firstParam = Array.from(params.keys())[0];
        return firstParam ? firstParam + '.md' : CONFIG.defaultFile;
      }
      
      // 加载侧边栏
      function loadSidebar() {
        fetch(CONFIG.sidebarFile)
          .then(res => res.ok ? res.text() : '# Navigation\n\n* [Home](README.md)')
          .then(text => {
            elements.sidebar.innerHTML = md.render(convertLinks(text));
            
            // 添加搜索UI
            createSearchUI();
            
            // 设置链接点击事件
            elements.sidebar.querySelectorAll('a').forEach(link => {
              link.addEventListener('click', e => {
                e.preventDefault();
                navigateTo(link.getAttribute('href'));
              });
            });
          })
          .catch(error => {
            console.error('Failed to load sidebar:', error);
            elements.sidebar.innerHTML = '<p>Error loading navigation</p>';
          });
      }
      
      // 创建搜索UI
      function createSearchUI() {
        const searchContainer = document.createElement('div');
        searchContainer.id = 'search-container';
        
        const searchBox = document.createElement('input');
        searchBox.type = 'text';
        searchBox.id = 'search-box';
        searchBox.placeholder = 'Search documentation...';
        searchBox.autocomplete = 'off';
        
        const searchResults = document.createElement('div');
        searchResults.id = 'search-results';
        
        searchContainer.appendChild(searchBox);
        searchContainer.appendChild(searchResults);
        
        // 添加到侧边栏顶部
        elements.sidebar.prepend(searchContainer);
        
        // 保存DOM引用
        elements.searchBox = searchBox;
        elements.searchResults = searchResults;
        elements.searchContainer = searchContainer;
        
        // 设置搜索事件监听
        setupSearchListeners();
        
        // 添加搜索历史
        renderSearchHistory();
      }
      
      // 设置搜索监听器
      function setupSearchListeners() {
        let searchTimeout;
        
        elements.searchBox.addEventListener('input', (e) => {
          clearTimeout(searchTimeout);
          const query = e.target.value.trim();
          
          if (query.length === 0) {
            hideSearchResults();
            renderSearchHistory();
            return;
          }
          
          // 显示加载状态
          elements.searchBox.classList.add('loading');
          
          searchTimeout = setTimeout(() => {
            performSearch(query);
          }, 300);
        });
        
        elements.searchBox.addEventListener('focus', () => {
          if (elements.searchBox.value.trim().length === 0 && state.searchHistory.length > 0) {
            renderSearchHistory();
          }
        });
        
        elements.searchBox.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowDown' || e.key === 'ArrowUp' || e.key === 'Enter') {
            handleSearchNavigation(e);
          }
        });
        
        // 点击外部关闭搜索结果
        document.addEventListener('click', (e) => {
          if (!elements.searchContainer.contains(e.target)) {
            hideSearchResults();
          }
        });
      }
      
      // 执行搜索
      function performSearch(query) {
        if (!state.searchIndex) {
          // 初始化搜索索引
          initializeSearchIndex().then(() => {
            executeSearch(query);
          });
        } else {
          executeSearch(query);
        }
      }
      
      // 初始化搜索索引
      function initializeSearchIndex() {
        return new Promise((resolve) => {
          // 如果已经初始化，直接返回
          if (state.searchIndex) {
            resolve();
            return;
          }
          
          // 从所有文档构建搜索索引
          const links = elements.sidebar.querySelectorAll('a[href^="?"]');
          const promises = [];
          
          links.forEach(link => {
            const file = link.getAttribute('href').substring(1) + '.md';
            promises.push(
              fetch(file)
                .then(res => res.ok ? res.text() : '')
                .then(text => {
                  return {
                    title: link.textContent,
                    file: file,
                    content: text.replace(/[#*\[\]()`]/g, ' ').replace(/\s+/g, ' ').substring(0, 500)
                  };
                })
                .catch(() => null)
            );
          });
          
          Promise.all(promises).then(results => {
            state.searchData = results.filter(item => item !== null);
            state.searchIndex = new Fuse(state.searchData, {
              keys: CONFIG.searchKeys,
              threshold: CONFIG.searchThreshold,
              includeScore: true,
              includeMatches: true
            });
            
            elements.searchBox.classList.remove('loading');
            resolve();
          });
        });
      }
      
      // 执行搜索
      function executeSearch(query) {
        const results = state.searchIndex.search(query);
        displaySearchResults(query, results.slice(0, CONFIG.maxSearchResults));
        
        // 添加到搜索历史
        addToSearchHistory(query);
      }
      
      // 显示搜索结果
      function displaySearchResults(query, results) {
        elements.searchResults.innerHTML = '';
        
        if (results.length === 0) {
          elements.searchResults.innerHTML = `<div class="no-results">No results found for "${query}"</div>`;
        } else {
          results.forEach((result, index) => {
            const item = result.item;
            const score = result.score;
            const matches = result.matches;
            
            const resultElement = document.createElement('div');
            resultElement.className = 'search-result-item';
            resultElement.dataset.file = item.file;
            resultElement.dataset.score = score;
            
            // 高亮匹配的文本
            let titleHtml = item.title;
            let contentSnippet = '';
            
            if (matches) {
              matches.forEach(match => {
                if (match.key === 'title') {
                  match.indices.forEach(([start, end]) => {
                    const matchedText = item.title.substring(start, end + 1);
                    titleHtml = titleHtml.replace(
                      matchedText, 
                      `<span class="search-highlight">${matchedText}</span>`
                    );
                  });
                } else if (match.key === 'content' && match.indices.length > 0) {
                  const [start, end] = match.indices[0];
                  const snippetStart = Math.max(0, start - 20);
                  const snippetEnd = Math.min(item.content.length, end + 30);
                  contentSnippet = '...' + item.content.substring(snippetStart, snippetEnd) + '...';
                  
                  // 高亮匹配部分
                  const matchedText = item.content.substring(start, end + 1);
                  contentSnippet = contentSnippet.replace(
                    matchedText,
                    `<span class="search-highlight">${matchedText}</span>`
                  );
                }
              });
            }
            
            resultElement.innerHTML = `
              <div>
                <div class="title">${titleHtml}</div>
                ${contentSnippet ? `<div class="content-snippet">${contentSnippet}</div>` : ''}
              </div>
              <div class="match-type">${score < 0.2 ? 'Exact' : score < 0.4 ? 'Close' : 'Fuzzy'}</div>
            `;
            
            resultElement.addEventListener('click', () => {
              navigateTo('?' + item.file.replace('.md', ''));
              hideSearchResults();
              elements.searchBox.value = '';
            });
            
            elements.searchResults.appendChild(resultElement);
          });
        }
        
        elements.searchResults.classList.add('visible');
        elements.searchBox.classList.remove('loading');
      }
      
      // 处理搜索导航
      function handleSearchNavigation(e) {
        const results = elements.searchResults.querySelectorAll('.search-result-item');
        if (results.length === 0) return;
        
        let selected = elements.searchResults.querySelector('.selected');
        
        if (e.key === 'ArrowDown') {
          e.preventDefault();
          if (!selected) {
            results[0].classList.add('selected');
          } else {
            selected.classList.remove('selected');
            const next = selected.nextElementSibling;
            if (next) {
              next.classList.add('selected');
            } else {
              results[0].classList.add('selected');
            }
          }
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          if (!selected) {
            results[results.length - 1].classList.add('selected');
          } else {
            selected.classList.remove('selected');
            const prev = selected.previousElementSibling;
            if (prev) {
              prev.classList.add('selected');
            } else {
              results[results.length - 1].classList.add('selected');
            }
          }
        } else if (e.key === 'Enter') {
          e.preventDefault();
          if (selected) {
            const file = selected.dataset.file;
            navigateTo('?' + file.replace('.md', ''));
            hideSearchResults();
            elements.searchBox.value = '';
          }
        }
        
        // 确保选中的结果在视图中
        selected = elements.searchResults.querySelector('.selected');
        if (selected) {
          selected.scrollIntoView({ block: 'nearest' });
        }
      }
      
      // 隐藏搜索结果
      function hideSearchResults() {
        elements.searchResults.classList.remove('visible');
      }
      
      // 添加到搜索历史
      function addToSearchHistory(query) {
        // 避免重复
        const index = state.searchHistory.indexOf(query);
        if (index !== -1) {
          state.searchHistory.splice(index, 1);
        }
        
        // 添加到开头
        state.searchHistory.unshift(query);
        
        // 限制历史记录大小
        if (state.searchHistory.length > CONFIG.searchHistorySize) {
          state.searchHistory.pop();
        }
        
        // 保存到localStorage
        localStorage.setItem('searchHistory', JSON.stringify(state.searchHistory));
      }
      
      // 渲染搜索历史
      function renderSearchHistory() {
        if (state.searchHistory.length === 0) return;
        
        const historyHTML = `
          <div id="search-history">
            <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
              <div class="history-title">Recent searches</div>
              <div class="clear-history" onclick="JSMD.clearSearchHistory()">Clear</div>
            </div>
            <div class="history-items">
              ${state.searchHistory.map(term => 
                `<div class="history-item" onclick="JSMD.setSearchTerm('${term}')">${term}</div>`
              ).join('')}
            </div>
          </div>
        `;
        
        elements.searchResults.innerHTML = historyHTML;
        elements.searchResults.classList.add('visible');
      }
      
      // 设置搜索词
      function setSearchTerm(term) {
        elements.searchBox.value = term;
        elements.searchBox.focus();
        performSearch(term);
      }
      
      // 清除搜索历史
      function clearSearchHistory() {
        state.searchHistory = [];
        localStorage.removeItem('searchHistory');
        hideSearchResults();
      }
      
      // 导航到页面
      function navigateTo(href) {
        const url = href.startsWith('?') ? href : '?' + href.replace('.md', '');
        history.pushState(null, '', url);
        loadContent(href.startsWith('?') ? href.substring(1) + '.md' : href);
        
        // 在移动设备上导航后自动关闭侧边栏
        if (window.innerWidth <= 768 && !state.sidebarHidden) {
          state.sidebarHidden = true;
          updateSidebarState();
          updateBodyClass();
        }
      }
      
      // 加载内容
      function loadContent(file) {
        state.currentFile = file;
        
        // 显示加载状态
        showLoadingState();
        
        // 检查缓存
        const cached = state.contentCache.get(file);
        if (cached && (Date.now() - cached.timestamp) < CONFIG.cacheExpiry) {
          renderContent(cached.content, file);
          return;
        }
        
        fetch(file)
          .then(res => {
            if (!res.ok) throw new Error(`Failed to load ${file}: ${res.status}`);
            return res.text();
          })
          .then(text => {
            // 缓存内容
            state.contentCache.set(file, {
              content: text,
              timestamp: Date.now()
            });
            
            renderContent(text, file);
          })
          .catch(error => {
            console.error(error);
            showErrorState(error.message, file);
          });
      }
      
      // 显示加载状态
      function showLoadingState() {
        elements.content.innerHTML = `
          <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading ${state.currentFile}...</p>
          </div>
        `;
      }
      
      // 显示错误状态
      function showErrorState(message, file) {
        elements.content.innerHTML = `
          <div class="error-container">
            <h2>Error Loading Content</h2>
            <p>${message}</p>
            <p><button onclick="JSMD.loadContent('${file}')">Retry</button></p>
          </div>
        `;
      }
      
      // 渲染内容
      function renderContent(text, file) {
        elements.content.innerHTML = md.render(convertLinks(text));
        elements.content.classList.add('content-transition');
        document.title = `${decodeURIComponent(file.replace('.md', ''))} - JSMD Website`;
        elements.content.scrollTop = 0;
        
        // 移除过渡类（为下一次添加做准备）
        setTimeout(() => {
          elements.content.classList.remove('content-transition');
        }, 300);
        
        // 检查是否需要数学公式渲染
        const hasMath = /\$\$[\s\S]*?\$\$|\$[^\n]*?\$/.test(text);
        
        if (hasMath) {
          if (state.mathJaxLoaded) {
            MathJax.typesetPromise && MathJax.typesetPromise([elements.content]);
          } else {
            loadMathJax().then(() => {
              MathJax.typesetPromise && MathJax.typesetPromise([elements.content]);
            });
          }
        }
      }
      
      // 公开API
      return {
        init,
        loadContent,
        toggleSidebar,
        setSearchTerm,
        clearSearchHistory
      };
    })();
    
    // 初始化应用
    document.addEventListener('DOMContentLoaded', JSMD.init);
  </script>
</body>
</html>